<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Enhanced Blackjack Game</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Press+Start+2P&display=swap');

  * {
    box-sizing: border-box;
  }

  body {
    background: #111;
    color: #c6c6ff;
    font-family: 'Orbitron', monospace, sans-serif;
    margin: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    user-select: none;
    background: linear-gradient(135deg, #120024 0%, #1a004d 100%);
  }

  h1 {
    font-family: 'Press Start 2P', cursive;
    font-size: 2rem;
    margin-bottom: 12px;
    color: #bb77ff;
    text-shadow:
      0 0 8px #bb77ff,
      0 0 15px #aa66ff;
  }

  .game-container {
    width: 100%;
    max-width: 700px;
    background: #1b004d;
    border-radius: 16px;
    box-shadow:
      0 0 20px #aa66ff66,
      inset 0 0 30px #551177cc;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .hand {
    display: flex;
    gap: 12px;
    min-height: 120px;
    justify-content: center;
  }

  .card {
    width: 70px;
    height: 100px;
    border-radius: 8px;
    background: linear-gradient(135deg, #eee 0%, #ccc 100%);
    box-shadow:
      0 4px 8px rgba(0,0,0,0.4),
      inset 0 0 6px #fff8;
    position: relative;
    color: #222;
    font-weight: bold;
    font-size: 18px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 8px 6px;
    user-select: none;
    cursor: default;
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  .heart, .diamond {
    color: #d00;
  }
  .spade, .club {
    color: #222;
  }

  .card .top-left,
  .card .bottom-right {
    font-size: 16px;
    user-select: none;
  }
  .card .bottom-right {
    transform: rotate(180deg);
    align-self: flex-end;
  }

  .card .center {
    font-size: 36px;
    text-align: center;
    line-height: 1;
  }

  .card.back {
    background: linear-gradient(135deg, #442277 0%, #110033 100%);
    box-shadow:
      0 0 15px #bb77ff,
      inset 0 0 20px #551177;
    position: relative;
  }
  .card.back::before {
    content: "";
    position: absolute;
    inset: 12px;
    border-radius: 6px;
    background:
      repeating-linear-gradient(
        45deg,
        #aa55ff,
        #aa55ff 6px,
        #660099 6px,
        #660099 12px
      );
    opacity: 0.8;
    z-index: 0;
  }

  .flip-container {
    perspective: 700px;
  }
  .flip-card {
    position: relative;
    width: 70px;
    height: 100px;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
    cursor: default;
  }
  .flip-card.flipped {
    transform: rotateY(180deg);
  }
  .flip-card .front,
  .flip-card .back {
    position: absolute;
    width: 70px;
    height: 100px;
    border-radius: 8px;
    backface-visibility: hidden;
    top: 0;
    left: 0;
  }
  .flip-card .back {
    transform: rotateY(180deg);
  }

  .controls {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }
  button {
    background: #3a0ca3;
    border: none;
    border-radius: 12px;
    color: #eee;
    font-family: 'Orbitron', monospace;
    font-weight: 700;
    padding: 12px 24px;
    font-size: 1rem;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    box-shadow:
      0 0 8px #7f3eff,
      inset 0 0 6px #7f3eff;
    transition:
      background 0.3s ease,
      box-shadow 0.3s ease,
      transform 0.15s ease;
    user-select: none;
  }
  button:hover:not(:disabled) {
    background: #7f3eff;
    box-shadow:
      0 0 20px #d6a9ff,
      inset 0 0 20px #d6a9ff;
    transform: scale(1.05);
  }
  button:active:not(:disabled) {
    transform: scale(0.95);
  }
  button:disabled {
    background: #555;
    box-shadow: none;
    cursor: not-allowed;
    color: #999;
  }

  .bet-control {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  input[type="range"] {
    -webkit-appearance: none;
    width: 180px;
    height: 8px;
    border-radius: 10px;
    background: #7f3eff;
    outline: none;
    cursor: pointer;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 22px;
    height: 22px;
    background: #d6a9ff;
    cursor: pointer;
    border-radius: 50%;
    box-shadow: 0 0 6px #d6a9ff;
    transition: background 0.3s ease;
  }
  input[type="range"]:active::-webkit-slider-thumb {
    background: #aa55ff;
  }
  input[type="number"] {
    width: 70px;
    padding: 6px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    text-align: center;
    font-family: 'Orbitron', monospace;
    background: #3a0ca3;
    color: #eee;
    box-shadow: inset 0 0 8px #7f3eff;
    user-select: text;
  }

  .chips-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
  }
  .chip-stack {
    width: 120px;
    height: 40px;
    border-radius: 20px;
    background: linear-gradient(135deg, #a55eff 0%, #550099 100%);
    box-shadow:
      0 0 14px #bb77ff,
      inset 0 0 18px #aa55ff;
    color: #eee;
    font-weight: 900;
    font-size: 1.3rem;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    position: relative;
    transition: transform 0.4s ease, box-shadow 0.4s ease;
  }
  .chip-stack.win-flash {
    animation: flashWin 1s ease forwards;
  }
  .chip-stack.lose-flash {
    animation: flashLose 1s ease forwards;
  }

  @keyframes flashWin {
    0%, 100% { box-shadow: 0 0 14px #bb77ff, inset 0 0 18px #aa55ff; }
    50% { box-shadow: 0 0 30px #88ff88, inset 0 0 28px #55aa55; transform: scale(1.08); }
  }
  @keyframes flashLose {
    0%, 100% { box-shadow: 0 0 14px #bb77ff, inset 0 0 18px #aa55ff; }
    50% { box-shadow: 0 0 30px #ff5555, inset 0 0 28px #aa5555; transform: scale(0.92); }
  }

  .status {
    text-align: center;
    font-size: 1.1rem;
    font-weight: 700;
    color: #d6a9ff;
    min-height: 28px;
    user-select: none;
  }

  .scoreboard {
    display: flex;
    justify-content: center;
    gap: 30px;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.8rem;
    margin-top: 8px;
    color: #bb77ffcc;
  }
  .scoreboard div {
    text-align: center;
  }

  .scoreboard div span {
    font-weight: 900;
    display: block;
    font-size: 1.1rem;
    color: #ddbbff;
  }

  @media (max-width: 480px) {
    .hand {
      min-height: 100px;
      gap: 8px;
    }
    .card {
      width: 55px;
      height: 80px;
      font-size: 14px;
    }
    .card .center {
      font-size: 26px;
    }
    button {
      padding: 10px 18px;
      font-size: 0.8rem;
    }
    .chip-stack {
      width: 100px;
      font-size: 1.1rem;
      height: 36px;
    }
  }
</style>
</head>
<body>

<h1>Blackjack</h1>
<div class="game-container" role="main" aria-label="Blackjack game">

  <div>
    <strong>Dealer's Hand (<span id="dealer-score">0</span>)</strong>
    <div id="dealer-hand" class="hand" aria-live="polite" aria-label="Dealer cards"></div>
  </div>

  <div>
    <strong>Your Hand (<span id="player-score">0</span>)</strong>
    <div id="player-hand" class="hand" aria-live="polite" aria-label="Player cards"></div>
  </div>

  <div class="status" aria-live="assertive" id="game-status"></div>

  <div class="chips-container" aria-label="Player chips and balance">
    <div class="chip-stack" id="balance-display" aria-live="polite">Balance: $1000</div>
    <div class="chip-stack" id="current-bet-display" aria-live="polite">Current Bet: $10</div>
  </div>

  <div class="bet-control" aria-label="Bet controls">
    <label for="bet-range">Bet Amount:</label>
    <input
      type="range"
      id="bet-range"
      min="10"
      max="1000"
      step="10"
      value="10"
      aria-valuemin="10"
      aria-valuemax="1000"
      aria-valuenow="10"
      aria-label="Bet amount slider"
    />
    <input
      type="number"
      id="bet-number"
      min="10"
      max="1000"
      step="10"
      value="10"
      aria-label="Bet amount input"
    />
  </div>

  <div class="controls" role="group" aria-label="Game controls">
    <button id="btn-deal" type="button">Deal</button>
    <button id="btn-hit" type="button" disabled>Hit</button>
    <button id="btn-stand" type="button" disabled>Stand</button>
    <button id="btn-reset" type="button" disabled>Reset</button>
  </div>

  <div class="scoreboard" aria-label="Game statistics">
    <div>
      Wins<br /><span id="wins">0</span>
    </div>
    <div>
      Losses<br /><span id="losses">0</span>
    </div>
    <div>
      Ties<br /><span id="ties">0</span>
    </div>
    <div>
      Hands Played<br /><span id="hands-played">0</span>
    </div>
    <div>
      Profit/Loss<br /><span id="profit-loss">$0</span>
    </div>
  </div>

</div>

<script>
(() => {
  'use strict';

  // Card ranks and suits for display
  const SUITS = ['♠', '♥', '♦', '♣'];
  const SUIT_CLASSES = ['spade', 'heart', 'diamond', 'club'];
  const RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

  // Game state
  let deck = [];
  let dealerHand = [];
  let playerHand = [];
  let playerBalance = 1000;
  let currentBet = 10;
  let gameInProgress = false;
  let handsPlayed = 0;
  let wins = 0;
  let losses = 0;
  let ties = 0;
  let profitLoss = 0;

  // DOM Elements
  const dealerHandEl = document.getElementById('dealer-hand');
  const playerHandEl = document.getElementById('player-hand');
  const dealerScoreEl = document.getElementById('dealer-score');
  const playerScoreEl = document.getElementById('player-score');
  const statusEl = document.getElementById('game-status');
  const balanceDisplay = document.getElementById('balance-display');
  const currentBetDisplay = document.getElementById('current-bet-display');
  const betRange = document.getElementById('bet-range');
  const betNumber = document.getElementById('bet-number');
  const btnDeal = document.getElementById('btn-deal');
  const btnHit = document.getElementById('btn-hit');
  const btnStand = document.getElementById('btn-stand');
  const btnReset = document.getElementById('btn-reset');

  const winsEl = document.getElementById('wins');
  const lossesEl = document.getElementById('losses');
  const tiesEl = document.getElementById('ties');
  const handsPlayedEl = document.getElementById('hands-played');
  const profitLossEl = document.getElementById('profit-loss');

  // Initialize deck (standard 52-card)
  function createDeck() {
    const newDeck = [];
    for (let s = 0; s < 4; s++) {
      for (let r = 0; r < RANKS.length; r++) {
        newDeck.push({ rank: RANKS[r], suit: SUITS[s], suitClass: SUIT_CLASSES[s] });
      }
    }
    return newDeck;
  }

  // Shuffle deck (Fisher-Yates)
  function shuffleDeck(deck) {
    for (let i = deck.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [deck[i], deck[j]] = [deck[j], deck[i]];
    }
  }

  // Calculate hand value (handle Aces as 1 or 11)
  function calculateScore(hand) {
    let sum = 0;
    let aces = 0;
    for (const card of hand) {
      if (card.rank === 'A') {
        aces++;
        sum += 11;
      } else if (['K', 'Q', 'J'].includes(card.rank)) {
        sum += 10;
      } else {
        sum += parseInt(card.rank, 10);
      }
    }
    while (sum > 21 && aces > 0) {
      sum -= 10;
      aces--;
    }
    return sum;
  }

  // Create a card DOM element with flipping animation container
  function createCardElement(card, faceUp = true) {
    // Flip container
    const flipContainer = document.createElement('div');
    flipContainer.classList.add('flip-container');

    // Flip card inner
    const flipCard = document.createElement('div');
    flipCard.classList.add('flip-card');
    if (!faceUp) flipCard.classList.add('flipped');

    // Front side
    const front = document.createElement('div');
    front.classList.add('card', 'front', card.suitClass);
    front.setAttribute('aria-label', `${card.rank} of ${card.suit === '♠' ? 'Spades' : card.suit === '♥' ? 'Hearts' : card.suit === '♦' ? 'Diamonds' : 'Clubs'}`);

    const topLeft = document.createElement('div');
    topLeft.className = 'top-left';
    topLeft.innerHTML = `${card.rank}<br><span class="${card.suitClass}">${card.suit}</span>`;

    const center = document.createElement('div');
    center.className = 'center';
    center.textContent = card.suit;

    const bottomRight = document.createElement('div');
    bottomRight.className = 'bottom-right';
    bottomRight.innerHTML = `${card.rank}<br><span class="${card.suitClass}">${card.suit}</span>`;

    front.appendChild(topLeft);
    front.appendChild(center);
    front.appendChild(bottomRight);

    // Back side
    const back = document.createElement('div');
    back.classList.add('card', 'back');
    back.setAttribute('aria-hidden', 'true');

    flipCard.appendChild(front);
    flipCard.appendChild(back);
    flipContainer.appendChild(flipCard);

    return flipContainer;
  }

  // Render hand cards to container
  function renderHand(hand, container, hideFirstCard = false) {
    container.innerHTML = '';
    hand.forEach((card, i) => {
      const cardEl = createCardElement(card, !(hideFirstCard && i === 0));
      container.appendChild(cardEl);
    });
  }

  // Update scores display
  function updateScores() {
    const dealerScore = calculateScore(dealerHand);
    const playerScore = calculateScore(playerHand);

    // If dealer's first card is hidden, show score as '?'
    dealerScoreEl.textContent = gameInProgress ? '?' : dealerScore;
    playerScoreEl.textContent = playerScore;
  }

  // Update balance and bet displays
  function updateChips() {
    balanceDisplay.textContent = `Balance: $${playerBalance}`;
    currentBetDisplay.textContent = `Current Bet: $${currentBet}`;
  }

  // Update game status message
  function updateStatus(msg, color = '#d6a9ff') {
    statusEl.textContent = msg;
    statusEl.style.color = color;
  }

  // Enable/disable buttons
  function setButtons({ deal, hit, stand, reset }) {
    btnDeal.disabled = !deal;
    btnHit.disabled = !hit;
    btnStand.disabled = !stand;
    btnReset.disabled = !reset;
  }

  // Reset game state
  function resetGame() {
    if (gameInProgress) return; // prevent reset during a game

    dealerHand = [];
    playerHand = [];
    deck = createDeck();
    shuffleDeck(deck);

    updateStatus('Place your bet and click Deal!', '#bb77ff');
    renderHand(dealerHand, dealerHandEl, false);
    renderHand(playerHand, playerHandEl, false);
    updateScores();
    setButtons({ deal: true, hit: false, stand: false, reset: false });
  }

  // Deal initial cards
  function dealCards() {
    if (gameInProgress) return;

    if (currentBet > playerBalance) {
      updateStatus('Insufficient balance for that bet!', '#ff5555');
      return;
    }

    gameInProgress = true;
    handsPlayed++;

    // Clear hands
    dealerHand = [];
    playerHand = [];

    // Deal two cards each
    playerHand.push(deck.pop());
    dealerHand.push(deck.pop());
    playerHand.push(deck.pop());
    dealerHand.push(deck.pop());

    updateScores();
    renderHand(dealerHand, dealerHandEl, true);
    renderHand(playerHand, playerHandEl, false);

    updateStatus('Hit or Stand?', '#aaffaa');
    setButtons({ deal: false, hit: true, stand: true, reset: false });
  }

  // Player hits
  function playerHit() {
    if (!gameInProgress) return;

    playerHand.push(deck.pop());
    renderHand(playerHand, playerHandEl, false);
    updateScores();

    const playerScore = calculateScore(playerHand);
    if (playerScore > 21) {
      endRound('Bust! You lose.', false);
    }
  }

  // Player stands, dealer's turn
  async function playerStand() {
    if (!gameInProgress) return;

    setButtons({ deal: false, hit: false, stand: false, reset: false });
    updateStatus('Dealer\'s turn...', '#ffffaa');

    // Reveal dealer cards
    renderHand(dealerHand, dealerHandEl, false);
    updateScores();

    // Dealer hits until 17 or more
    await new Promise(r => setTimeout(r, 700));

    while (calculateScore(dealerHand) < 17) {
      dealerHand.push(deck.pop());
      renderHand(dealerHand, dealerHandEl, false);
      updateScores();
      await new Promise(r => setTimeout(r, 700));
    }

    const dealerScore = calculateScore(dealerHand);
    const playerScore = calculateScore(playerHand);

    if (dealerScore > 21) {
      endRound('Dealer busts! You win!', true);
    } else if (dealerScore > playerScore) {
      endRound('Dealer wins.', false);
    } else if (dealerScore < playerScore) {
      endRound('You win!', true);
    } else {
      endRound('Push (tie).', null);
    }
  }

  // End round with result: win (true), lose (false), or tie (null)
  function endRound(message, playerWon) {
    gameInProgress = false;

    if (playerWon === true) {
      wins++;
      playerBalance += currentBet;
      profitLoss += currentBet;
      flashChips(true);
      updateStatus(message, '#55ff55');
    } else if (playerWon === false) {
      losses++;
      playerBalance -= currentBet;
      profitLoss -= currentBet;
      flashChips(false);
      updateStatus(message, '#ff5555');
    } else {
      ties++;
      updateStatus(message, '#aaaaaa');
    }

    updateScores();
    updateChips();
    updateStats();
    setButtons({ deal: true, hit: false, stand: false, reset: true });
  }

  // Flash chips on win/lose
  function flashChips(win) {
    const className = win ? 'win-flash' : 'lose-flash';
    balanceDisplay.classList.add(className);
    currentBetDisplay.classList.add(className);
    setTimeout(() => {
      balanceDisplay.classList.remove(className);
      currentBetDisplay.classList.remove(className);
    }, 1000);
  }

  // Update statistics display
  function updateStats() {
    winsEl.textContent = wins;
    lossesEl.textContent = losses;
    tiesEl.textContent = ties;
    handsPlayedEl.textContent = handsPlayed;
    profitLossEl.textContent = (profitLoss >= 0 ? '$' : '-$') + Math.abs(profitLoss);
    profitLossEl.style.color = profitLoss > 0 ? '#55ff55' : (profitLoss < 0 ? '#ff5555' : '#ddd');
  }

  // Validate and sync bet inputs
  function syncBetInputs(e) {
    let val = parseInt(e.target.value, 10);

    if (isNaN(val) || val < 10) val = 10;
    if (val > 1000) val = 1000;

    currentBet = val;
    betRange.value = val;
    betNumber.value = val;
    updateChips();
  }

  // Initialization on load
  function init() {
    resetGame();
    updateChips();
    updateStats();

    // Event listeners
    btnDeal.addEventListener('click', () => {
      dealCards();
    });
    btnHit.addEventListener('click', () => {
      playerHit();
    });
    btnStand.addEventListener('click', async () => {
      await playerStand();
    });
    btnReset.addEventListener('click', () => {
      resetGame();
    });

    betRange.addEventListener('input', syncBetInputs);
    betNumber.addEventListener('input', syncBetInputs);

    // Keyboard accessibility: space/enter on buttons triggers click
    [btnDeal, btnHit, btnStand, btnReset].forEach(btn => {
      btn.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          btn.click();
        }
      });
    });
  }

  // Run init after DOM loaded
  window.addEventListener('DOMContentLoaded', init);

})();
</script>

</body>
</html>
